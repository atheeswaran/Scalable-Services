version: '3.9'
services:
  maindb:
    image: mysql:latest
    restart: always
    container_name: maindb
    hostname: maindb
    environment:
       #MYSQL_ALLOW_EMPTY_PASSWORD: 'true'
       MYSQL_ROOT_PASSWORD: test
       MYSQL_DATABASE: hcdb
    ports: 
       - "3306:3306"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - my-network
      
  registerusers:
              build:
                  context: ./RegisterUsers  # Path to the Doctors Service Dockerfile
                  dockerfile: Dockerfile
              container_name: registerusers
              links:
                - maindb:maindb
              command: >
                  bash -c "python manage.py makemigrations && python manage.py migrate && python manage.py runserver 0.0.0.0:8000"

              ports:
                   - "10555:8001"  # Doctors service port
              volumes:
                   - .:/code
              restart: always
              networks:
                 - my-network
            

  appointmentscheduling:
                        build:
                          context: ./AppointmentScheduling  # Path to the Appointment Booking Service Dockerfile
                          dockerfile: Dockerfile
                        command:
                          bash -c "python manage.py runserver 0.0.0.0:8000"
                        ports:
                          - "8001:8000"  # Appointments service port
                        volumes:
                           - .:/code

  notification:
              build:
                context: ./Notification  # Path to the Notification Service Dockerfile
                dockerfile: Dockerfile
              command:
                  bash -c "python manage.py runserver 0.0.0.0:8000"
              ports:
                - "8002:8000"  # Notifications service port
              volumes:
                 - .:/code

networks:
  my-network:
    driver: bridge